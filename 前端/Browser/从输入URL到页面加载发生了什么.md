## 从输入URL到页面加载发生了什么

1. DNS 解析
2. TCP/IP 连接
3. 浏览器发送 HTTP 请求
4. 服务端响应请求
5. 浏览器解析渲染页面

浏览器是多进程的，每一个 tab 标签页就是一个进程，也就是浏览器渲染进程，这个进程里面包含了多个线程：

* GUI 线程
* JS 引擎线程
* 事件触发线程
* 定时器线程
* 网络请求线程

在浏览器输入 url 后，浏览器首先会开启一条网络请求线程去请求加载资源。从开启网络线程到发出 HTTP 请求的过程中会经过 DNS 解析，TCP/IP 连接等步骤。

### DNS 解析

简单来说，DNS 解析就是将 url 域名解析查询得到对应的 IP 地址的过程。

#### 为什么需要 DNS 解析

因为网络通讯都是基于 TCP/IP 的，而 TCP/IP 是基于 IP 地址识别访问的，而计算机只能识别 IP 地址，而 IP 地址并不方便记忆，所以互联网设计者在用户的方便性和可用性之间做一个权衡，也就是用网址来代替 IP 地址的使用，但实际还是需要 DNS 解析出 IP 地址访问。

### TCP/IP 连接

这一步就会经过网络的三次握手和服务器建立连接，之后客户端就会发起 HTTP 请求。

### HTTP 请求

客户端发送 HTTP 请求就是构建 HTTP 请求报文并通过 TCP 协议将请求发送给服务端。请求报文由请求行，请求头，请求正文组成。

这里涉及到一个优化知识点，HTTP 缓存也就是浏览器缓存，合理使用浏览器缓存对页面性能更好。在请求头中携带缓存标识的字段发送给服务端，服务端设置好响应的缓存规则后再响应头中携带过来，浏览器会根据缓存规则作出相应的缓存。浏览器缓存分为强缓存和协商缓存，强缓存如果缓存未失效就使用本地资源，不需要发起请求；而协商缓存会像服务端发起请求验证缓存是否失效，未失效就返回304状态码继续使用本地缓存。

[浏览器缓存机制](https://github.com/webproblem/Blog/blob/master/%E5%89%8D%E7%AB%AF/Performance/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6.md)

#### http, https 的区别

* http 协议传输的数据都是明文未加密的，是无状态的，存在安全问题
* https 本质是 http + SSL，使用 SSL 对 http 协议传输的数据进行加密

### 服务端响应请求

服务端接收到了客户端发起的请求后，后端会进行一系列的处理：

* 会先进行验证，安全拦截，跨域验证等
* 验证通过后，才进入到后端代码并执行相关的处理逻辑代码
* 后端程序执行完毕后会返回一个 http 响应包
* 将响应包返回给客户端，完成响应

响应报文由状态码，响应头，响应报文组成。

### 浏览器解析渲染页面

浏览器获取到 html 文件后就开始解析渲染页面。大致流程如下：

* 解析 HTML 生成 DOM tree
* 解析 CSS 生成 CSSOM tree
* 合并 DOM tree 和 CSSOM tree，构建 render 树
* 布局 render 树，计算元素的尺寸大小，位置
* 绘制 render 树，绘制页面像素信息
* 合并图层，显示在屏幕上

这个过程中也涉及到了很多优化点：回流重绘，css阻塞DOM渲染，js阻塞DOM解析渲染等

### 推荐阅读

[从输入URL到页面加载发生了什么](https://segmentfault.com/a/1190000006879700)

[从输入URL到页面加载的过程？如何由一道题完善自己的前端知识体系！](https://zhuanlan.zhihu.com/p/34453198)

[详细解析 HTTP 与 HTTPS 的区别](https://juejin.im/entry/58d7635e5c497d0057fae036)

[深入浅出浏览器渲染原理](https://juejin.im/post/5c24d736f265da614b120d4a)



